<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core">
    <h:head>
        <title>Tickets - Sistema de Usuarios</title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <style type="text/css">
            :root {
                --color-primario: #2c5aa0;
                --color-secundario: #34495e;
                --color-acento: #3498db;
                --color-exito: #27ae60;
                --color-peligro: #e74c3c;
                --color-advertencia: #f39c12;
                --luz-bg: #f8f9fa;
                --texto-oscuro: #2c3e50;
            }
            body {
                margin: 0;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background-color: var(--luz-bg);
                color: var(--texto-oscuro);
            }
            .header {
                background-color: var(--color-primario);
                color: white;
                padding: 15px 30px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            .header h1 {
                margin: 0;
                font-size: 1.5em;
            }
            .header-right {
                display: flex;
                align-items: center;
                gap: 15px;
            }
            .btn-logout {
                background-color: var(--color-peligro);
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 6px;
                font-weight: bold;
                cursor: pointer;
            }
            .container-custom {
                max-width: 1200px;
                margin: 30px auto;
                padding: 30px;
                background-color: #ffffff;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
            .buttons-nav {
                display: flex;
                gap: 15px;
                margin-bottom: 20px;
            }
            .btn-secondary {
                background-color: var(--color-secundario);
                border: none;
            }
            .badge {
                padding: 4px 10px;
                border-radius: 12px;
                color: white;
                font-size: 0.85em;
                font-weight: bold;
            }
            .pendiente {
                background-color: var(--color-advertencia);
            }
            .revision {
                background-color: var(--color-acento);
            }
            .aprobado {
                background-color: var(--color-exito);
            }
            .rechazado {
                background-color: var(--color-peligro);
            }
            .actions {
                display: flex;
                gap: 5px;
            }
            .btn-sm {
                padding: 4px 8px;
                font-size: 0.8em;
            }
        </style>
    </h:head>
    <h:body>
        <div class="header">
            <h1>Tickets de Revisi√≥n</h1>
            <div class="header-right">
                <span>Bienvenido, <strong>#{loginBean.currentUser.nombreCompleto}</strong></span>
                <h:button value="‚Üê Usuarios" outcome="usuarios" styleClass="btn-logout" />
            </div>
        </div>

        <div class="messages-container" style="max-width: 1200px; margin: 20px auto;">
            <h:messages globalOnly="false" layout="list" showDetail="true" showSummary="true" 
                       infoClass="alert alert-info" warnClass="alert alert-warning" 
                       errorClass="alert alert-danger" fatalClass="alert alert-danger"/>
        </div>

        <div class="container-custom">
            <h2>Listado de Solicitudes Pendientes</h2>

            <div class="buttons-nav">
                <h:commandButton value="Todos"
                                 styleClass="btn btn-secondary"
                                 action="#{ticketBean.filterTicketsByState('Todos')}">
                    <f:ajax execute="@this" render="ticketsTable messages" />
                </h:commandButton>
                <h:commandButton value="Pendientes"
                                 styleClass="btn btn-warning"
                                 action="#{ticketBean.filterTicketsByState('Pendiente')}">
                    <f:ajax execute="@this" render="ticketsTable messages" />
                </h:commandButton>
                <h:commandButton value="En Revisi√≥n"
                                 styleClass="btn btn-info"
                                 action="#{ticketBean.filterTicketsByState('En Revisi√≥n')}">
                    <f:ajax execute="@this" render="ticketsTable messages" />
                </h:commandButton>
                <h:commandButton value="üîÑ Refrescar"
                                 styleClass="btn btn-secondary"
                                 action="#{ticketBean.loadTickets}">
                    <f:ajax execute="@this" render="ticketsTable messages" />
                </h:commandButton>
            </div>

            <h:dataTable value="#{ticketBean.tickets}" var="ticket" styleClass="table table-striped" id="ticketsTable">
                <h:column>
                    <f:facet name="header">ID Ticket</f:facet>
                    #{ticket.idTicket}
                </h:column>
                <h:column>
                    <f:facet name="header">Tipo de Cambio</f:facet>
                    #{ticket.idTipoCambio.nombreCambio}
                </h:column>
                <h:column>
                    <f:facet name="header">M√≥dulo</f:facet>
                    #{ticket.idModulo.nombreModulo}
                </h:column>
                <h:column>
                    <f:facet name="header">Fecha Solicitud</f:facet>
                    <h:outputText value="#{ticket.fechaSolicitud}">
                        <f:convertDateTime pattern="yyyy-MM-dd" />
                    </h:outputText>
                </h:column>
                <h:column>
                    <f:facet name="header">Estado</f:facet>
                    <span class="badge #{ticket.idEstado.nombreEstado.toLowerCase().replace(' ', '-')}">
                        #{ticket.idEstado.nombreEstado}
                    </span>
                </h:column>
                <h:column>
                    <f:facet name="header">Usuario Solicitante</f:facet>
                    #{ticket.idUsuario.nombreCompleto}
                </h:column>
                <h:column>
                    <f:facet name="header">Acciones</f:facet>
                    <div class="actions">
                        <h:commandButton value="Revisar"
                                         styleClass="btn btn-primary btn-sm"
                                         action="#{ticketBean.selectTicketForReview}"
                                         disabled="#{ticket.idEstado.nombreEstado == 'Aprobado' or ticket.idEstado.nombreEstado == 'Rechazado'}">
                            <f:param name="ticketId" value="#{ticket.idTicket}" />
                            <f:ajax execute="@this" render="@messages" />
                        </h:commandButton>
                    </div>
                </h:column>
            </h:dataTable>
        </div>
    </h:body>
</html>