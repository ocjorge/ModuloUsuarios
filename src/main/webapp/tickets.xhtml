<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Tickets de Revisión</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" />

    <style>
        body { background-color:#f4f6f9; }
        .topbar {
            background:#225ca8;
            color:white;
            padding:14px 24px;
            font-size:22px;
            font-weight:bold;
        }
    </style>
</h:head>

<h:body>

<!-- BARRA SUPERIOR -->
<div class="topbar d-flex justify-content-between align-items-center">
    Tickets Pendientes
    <h:form>
        <h:commandLink value="Dashboard"
                       action="dashboard.xhtml?faces-redirect=true"
                       styleClass="btn btn-light"/>
    </h:form>
</div>

<div class="container my-4">

    <!-- METADATA -->
    <f:metadata>
        <f:viewAction action="#{ticketBean.verificarSesion}" />
        <f:viewAction action="#{ticketBean.init}" />
    </f:metadata>

    <h:form>

        <h2 class="mb-3">Filtros</h2>

        <div class="row g-3">

            <!-- Filtro Módulo -->
            <div class="col-md-4">
                <label class="form-label">Módulo</label>
                <h:selectOneMenu value="#{ticketBean.moduloFiltro}"
                                 styleClass="form-select">
                    <f:selectItem itemValue="" itemLabel="Todos"/>
                    <f:selectItems value="#{ticketBean.modulos}" var="m"
                                   itemLabel="#{m.nombre}" itemValue="#{m.id}" />
                </h:selectOneMenu>
            </div>

            <!-- Filtro Estado -->
            <div class="col-md-4">
                <label class="form-label">Estado</label>
                <h:selectOneMenu value="#{ticketBean.estadoFiltro}"
                                 styleClass="form-select">
                    <f:selectItem itemValue="" itemLabel="Todos"/>
                    <f:selectItems value="#{ticketBean.estados}" var="e"
                                   itemLabel="#{e.nombre}" itemValue="#{e.id}" />
                </h:selectOneMenu>
            </div>

            <!-- BOTÓN FILTRAR -->
            <div class="col-md-4 d-flex align-items-end">
                <h:commandButton value="Filtrar"
                                 action="#{ticketBean.filtrar}"
                                 styleClass="btn btn-primary w-100"/>
            </div>
        </div>

        <hr/>

        <h2 class="mt-4">Listado de Tickets</h2>

        <h:dataTable value="#{ticketBean.tickets}"
                     var="t"
                     styleClass="table table-hover table-bordered mt-3">

            <!-- Usuario -->
            <h:column>
                <f:facet name="header">Usuario</f:facet>
                #{t.usuario.nombreCompleto}
            </h:column>

            <!-- Módulo -->
            <h:column>
                <f:facet name="header">Módulo</f:facet>
                #{t.modulo.nombre}
            </h:column>

            <!-- Tipo Cambio -->
            <h:column>
                <f:facet name="header">Tipo de Cambio</f:facet>
                #{t.tipoCambio.nombre}
            </h:column>

            <!-- Estado -->
            <h:column>
                <f:facet name="header">Estado</f:facet>
                <span class="badge bg-info text-dark">#{t.estado.nombre}</span>
            </h:column>

            <!-- Fecha -->
            <h:column>
                <f:facet name="header">Fecha</f:facet>
                <h:outputText value="#{t.fechaSolicitud}">
                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                </h:outputText>
            </h:column>

            <!-- Detalle -->
            <h:column>
                <f:facet name="header">Detalle</f:facet>
                <h:link outcome="ticket-detalle.xhtml"
                        value="Ver"
                        styleClass="btn btn-sm btn-secondary">
                    <f:param name="id" value="#{t.id}"/>
                </h:link>
            </h:column>

        </h:dataTable>

    </h:form>

</div>

</h:body>
</html>
