<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Reportes del Sistema</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" />

    <style>
        body { background-color:#f2f4f8; }
        .topbar {
            background:#225ca8;
            color:white;
            padding:14px 24px;
            font-size:22px;
            font-weight:bold;
        }
        .card-mini {
            border-left:5px solid #225ca8;
        }
    </style>
</h:head>

<h:body>

<!-- TOPBAR -->
<div class="topbar d-flex justify-content-between align-items-center">
    Reportes del Sistema
    <h:form>
        <h:commandLink value="Dashboard"
                       action="dashboard.xhtml?faces-redirect=true"
                       styleClass="btn btn-light"/>
    </h:form>
</div>

<div class="container my-4">

    <f:metadata>
        <f:viewAction action="#{reportesBean.verificarSesion}" />
        <f:viewAction action="#{reportesBean.init}" />
    </f:metadata>

    <!-- RESUMEN -->
    <div class="row g-4">

        <div class="col-md-4">
            <div class="card card-mini p-3 shadow-sm">
                <h5>Total Accesos</h5>
                <h3 class="text-primary">#{reportesBean.totalAccesos}</h3>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card card-mini p-3 shadow-sm">
                <h5>Cambios Realizados</h5>
                <h3 class="text-success">#{reportesBean.totalAcciones}</h3>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card card-mini p-3 shadow-sm">
                <h5>Tickets Revisados</h5>
                <h3 class="text-danger">#{reportesBean.totalTickets}</h3>
            </div>
        </div>

    </div>

    <hr class="my-4"/>

    <!-- ACCESOS -->
    <h2 class="mb-3">Historial de Accesos</h2>

    <h:dataTable value="#{reportesBean.accesos}"
                 var="a"
                 styleClass="table table-hover table-bordered">

        <h:column>
            <f:facet name="header">Usuario</f:facet>
            #{a.usuario.nombreCompleto}
        </h:column>

        <h:column>
            <f:facet name="header">Evento</f:facet>
            #{a.tipoEvento.nombre}
        </h:column>

        <h:column>
            <f:facet name="header">Fecha</f:facet>
            <h:outputText value="#{a.fechaHora}">
                <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
            </h:outputText>
        </h:column>

    </h:dataTable>

    <hr/>

    <!-- ACCIONES -->
    <h2 class="mb-3">Acciones Realizadas</h2>

    <h:dataTable value="#{reportesBean.acciones}"
                 var="ac"
                 styleClass="table table-hover table-bordered">

        <h:column>
            <f:facet name="header">Usuario</f:facet>
            #{ac.usuario.nombreCompleto}
        </h:column>

        <h:column>
            <f:facet name="header">Acci√≥n</f:facet>
            #{ac.accion.nombre}
        </h:column>

        <h:column>
            <f:facet name="header">Registro Afectado</f:facet>
            #{ac.registroAfectado}
        </h:column>

        <h:column>
            <f:facet name="header">Fecha</f:facet>
            <h:outputText value="#{ac.fechaHora}">
                <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
            </h:outputText>
        </h:column>

    </h:dataTable>

</div>

</h:body>
</html>
