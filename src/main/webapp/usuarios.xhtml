<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core">
    <h:head>
        <title>Usuarios - Sistema de Usuarios</title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <style type="text/css">
            :root {
                --color-primario: #2c5aa0;
                --color-secundario: #34495e;
                --color-acento: #3498db;
                --color-exito: #27ae60;
                --color-peligro: #e74c3c;
                --luz-bg: #f8f9fa;
                --texto-oscuro: #2c3e50;
            }
            body {
                margin: 0;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background-color: var(--luz-bg);
                color: var(--texto-oscuro);
            }
            .header {
                background-color: var(--color-primario);
                color: white;
                padding: 15px 30px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            .header h1 {
                margin: 0;
                font-size: 1.5em;
            }
            .header-right {
                display: flex;
                align-items: center;
                gap: 15px;
            }
            .btn-logout {
                background-color: var(--color-peligro);
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 6px;
                font-weight: bold;
                cursor: pointer;
            }
            .container-custom {
                max-width: 1200px;
                margin: 30px auto;
                padding: 30px;
                background-color: #ffffff;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
            .buttons-nav {
                display: flex;
                gap: 15px;
                margin-bottom: 20px;
            }
            .btn-success {
                background-color: var(--color-exito);
                border: none;
            }
            .btn-info {
                background-color: var(--color-acento);
                border: none;
            }
            .badge {
                padding: 4px 10px;
                border-radius: 12px;
                color: white;
                font-size: 0.85em;
                font-weight: bold;
            }
            .activo {
                background-color: var(--color-exito);
            }
            .inactivo {
                background-color: var(--color-peligro);
            }
            .bloqueado {
                background-color: var(--color-secundario);
            }
            .actions {
                display: flex;
                gap: 5px;
            }
            .btn-sm {
                padding: 4px 8px;
                font-size: 0.8em;
            }
        </style>
    </h:head>
    <h:body>
        <div class="header">
            <h1>Gesti√≥n de Usuarios</h1>
            <div class="header-right">
                <span>Bienvenido, <strong>#{loginBean.currentUser.nombreCompleto}</strong></span>
                <h:commandButton value="Cerrar Sesi√≥n" styleClass="btn-logout" action="#{loginBean.logout}">
                    <f:ajax execute="@this" render="@none" />
                </h:commandButton>
            </div>
        </div>

        <div class="messages-container" style="max-width: 1200px; margin: 20px auto;">
            <h:messages globalOnly="false" layout="list" showDetail="true" showSummary="true" 
                       infoClass="alert alert-info" warnClass="alert alert-warning" 
                       errorClass="alert alert-danger" fatalClass="alert alert-danger"/>
        </div>

        <div class="container-custom">
            <h2>Lista de Usuarios</h2>

            <div class="buttons-nav">
                <h:button value="+ Nuevo Usuario" outcome="nuevo-usuario" styleClass="btn btn-success" />
                <h:button value="üìã Tickets" outcome="tickets" styleClass="btn btn-info" />
                <h:commandButton value="üîÑ Refrescar" styleClass="btn btn-secondary" action="#{usuarioBean.loadUsuarios}">
                    <f:ajax execute="@this" render="usersTable messages" />
                </h:commandButton>
            </div>

            <h:dataTable value="#{usuarioBean.usuarios}" var="user" styleClass="table table-striped" id="usersTable">
                <h:column>
                    <f:facet name="header">Nombre</f:facet>
                    #{user.nombreCompleto}
                </h:column>
                <h:column>
                    <f:facet name="header">Correo</f:facet>
                    #{user.correoElectronico}
                </h:column>
                <h:column>
                    <f:facet name="header">M√≥dulo</f:facet>
                    #{user.idModulo != null ? user.idModulo.nombreModulo : 'N/A'}
                </h:column>
                <h:column>
                    <f:facet name="header">Tel√©fono</f:facet>
                    #{user.telefono}
                </h:column>
                <h:column>
                    <f:facet name="header">Estado</f:facet>
                    <span class="badge #{user.idEstadoCuenta.nombreEstado.toLowerCase()}">
                        #{user.idEstadoCuenta.nombreEstado}
                    </span>
                </h:column>
                <h:column>
                    <f:facet name="header">Rol</f:facet>
                    #{user.idRol != null ? user.idRol.nombreRol : 'N/A'}
                </h:column>
                <h:column>
                    <f:facet name="header">Acciones</f:facet>
                    <div class="actions">
                        <h:button value="Editar" outcome="editar-usuario" styleClass="btn btn-primary btn-sm">
                            <f:param name="id" value="#{user.idUsuario}" />
                        </h:button>
                        <h:commandButton value="Eliminar" styleClass="btn btn-danger btn-sm"
                                       onclick="return confirm('¬øEst√° seguro de eliminar a #{user.nombreCompleto}?');"
                                       action="#{usuarioBean.deleteUsuario(user.idUsuario)}">
                            <f:ajax execute="@this" render="usersTable messages" />
                        </h:commandButton>
                    </div>
                </h:column>
            </h:dataTable>
        </div>
    </h:body>
</html>